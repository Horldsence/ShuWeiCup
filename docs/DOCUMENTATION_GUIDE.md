# 文档组织指南

本文档说明了 ShuWeiCamp 项目中各个任务（Task 1-4）的文档结构和组织方式。

---

## 文档结构概述

每个任务的文档分为两个主要部分：

1. **README.md** - 原理与设计
2. **training_guide.md** - 接口与使用

---

## 文档分工原则

### README.md（原理与设计）

**内容定位**：理论基础、架构设计、数学推导

**主要内容**：
- 理论基础与背景知识
- 核心算法原理
- 数学公式推导
- 架构设计思想
- 设计决策与权衡
- 关键组件工作原理
- 技术细节与实现逻辑
- 相关论文与参考文献

**目标读者**：
- 希望深入理解算法原理的开发者
- 需要改进或扩展模型的研究人员
- 对技术细节感兴趣的学习者

**示例主题**：
- "为什么使用 ArcFace 而不是传统 Softmax？"
- "多任务学习的理论基础"
- "Grad-CAM 的数学推导"
- "动态任务权重的优化目标"

---

### training_guide.md（接口与使用）

**内容定位**：命令行接口、实用指南、操作手册

**主要内容**：
- 快速开始示例
- 命令行参数详解
- 参数取值范围和建议
- 完整使用示例
- 输出文件说明
- 性能调优建议
- 常见问题排查
- 实用技巧和最佳实践

**目标读者**：
- 需要快速上手训练模型的用户
- 进行实验和调参的工程师
- 希望复现结果的研究人员

**示例主题**：
- "如何设置训练参数？"
- "不同 GPU 内存下的配置建议"
- "如何生成诊断报告？"
- "训练失败如何排查？"

---

## 各任务文档位置

### Task 1: 61类病害分类

```
docs/task1/
├── README.md              # 原理：长尾分布处理、损失函数设计、渐进式训练
└── training_guide.md      # 接口：参数说明、使用示例、调优建议
```

**核心原理**：
- CosineClassifier 与 Center Loss 原理
- Mixup/CutMix 数学推导
- 加权采样与类别平衡策略
- 渐进式分辨率调整理论
- ModelEMA 与训练稳定性

---

### Task 2: 少样本学习

```
docs/task2/
├── README.md              # 原理：ArcFace、原型网络、度量学习理论
└── training_guide.md      # 接口：参数说明、使用示例、调优建议
```

**核心原理**：
- ArcFace 的角度边界推导
- 原型网络（Prototypical Network）理论
- 少样本学习的挑战与解决方案
- 延迟解冻（Delayed Unfreeze）策略
- 原型 EMA 更新机制

---

### Task 3: 严重度分级

```
docs/task3/
├── README.md              # 原理：确定性映射、Grad-CAM、类别不平衡
└── training_guide.md      # 接口：参数说明、使用示例、调优建议
```

**核心原理**：
- 3级到4级的确定性映射设计
- MD5 哈希拆分的理论依据
- Grad-CAM 可视化原理与推导
- 类别权重计算方法（inverse, sqrt, balanced）
- 温度校准（Temperature Scaling）理论

---

### Task 4: 多任务学习

```
docs/task4/
├── README.md              # 原理：多任务学习理论、动态权重、协同效应
└── training_guide.md      # 接口：参数说明、使用示例、调优建议
```

**核心原理**：
- 多任务学习（MTL）理论基础
- Hard vs Soft Parameter Sharing
- 动态任务权重优化（Loss-Based, GradNorm, Uncertainty Weighting）
- 任务相关性分析与互信息
- 协同效应（Task Synergy）的数学解释
- 泛化误差界与 VC 维理论

---

## 阅读建议

### 快速上手

如果你只是想**快速训练模型**：
1. 直接阅读 `training_guide.md`
2. 查看"快速开始"部分
3. 根据你的硬件选择合适的配置示例
4. 复制命令并运行

### 深入理解

如果你想**深入理解算法**：
1. 先阅读 `README.md` 了解理论基础
2. 理解核心组件的工作原理
3. 参考数学推导和设计决策
4. 再通过 `training_guide.md` 实践验证

### 调优与改进

如果你需要**调优或改进模型**：
1. 从 `README.md` 理解现有设计的原理
2. 了解各个超参数背后的理论依据
3. 在 `training_guide.md` 中找到对应参数
4. 进行有针对性的实验

### 论文复现

如果你要**复现论文结果**：
1. 阅读 `README.md` 中的参考文献
2. 理解实现与原论文的差异
3. 使用 `training_guide.md` 中的完整配置
4. 注意随机种子和超参数设置

---

## 文档更新原则

### 何时更新 README.md

- 添加新的算法或模块
- 修改核心架构设计
- 发现理论错误或不准确描述
- 添加新的理论分析
- 引入新的参考文献

### 何时更新 training_guide.md

- 添加新的命令行参数
- 修改参数默认值或取值范围
- 添加新的使用示例
- 更新性能基准或调优建议
- 修复常见问题的解决方案

---

## 文档质量标准

### README.md 质量标准

**必须包含**：
- ✅ 清晰的数学公式（使用 LaTeX 或代码块）
- ✅ 设计决策的理由说明
- ✅ 关键算法的伪代码或流程图
- ✅ 至少 3 个核心参考文献
- ✅ 理论优势与局限性分析

**可选内容**：
- 📊 算法复杂度分析
- 📈 理论性能界（Bound）推导
- 🔬 消融实验设计建议
- 📚 扩展阅读材料

---

### training_guide.md 质量标准

**必须包含**：
- ✅ 至少 1 个快速开始示例
- ✅ 所有参数的详细说明
- ✅ 至少 5 个完整使用示例
- ✅ 输出文件结构说明
- ✅ 至少 3 个常见问题及解决方案

**可选内容**：
- 🎯 针对不同场景的配置建议
- 🔧 高级用法和技巧
- 📊 性能基准数据
- 🐛 调试技巧

---

## 示例对比

### 错误示例（混淆原理与接口）

**❌ 不好的 training_guide.md**：
```markdown
## ArcFace 原理

ArcFace 通过在角度空间添加边界来增强类间分离度。
数学公式为：L = -log(exp(s·cos(θ + m)) / ...)

## 如何使用

运行：python task2train.py --arcface-margin 0.3
```

**问题**：原理和接口混在一起，用户只想知道如何设置参数，不需要看公式。

---

### 正确示例（职责分离）

**✅ 好的 README.md**：
```markdown
## ArcFace 理论推导

### 基本原理
ArcFace（Additive Angular Margin）通过在角度空间添加边界...

### 数学推导
目标函数：
L_ArcFace = -log(exp(s·cos(θ_yi + m)) / Σ_j exp(s·cos(θ_j)))

其中：
- s: scale 参数，控制特征空间紧凑度
- m: margin 参数，类间角度边界
- θ_yi: 样本与目标类的夹角

### 为什么有效
1. 归一化消除幅值影响
2. 角度边界强制类间分离
3. 几何意义清晰直观
```

**✅ 好的 training_guide.md**：
```markdown
## ArcFace 参数

### --arcface-margin MARGIN
角度边界大小（弧度）

**取值范围**：[0.2, 0.5]  
**默认值**：0.30  
**推荐值**：
- 简单任务：0.20-0.25
- 中等难度：0.30-0.35
- 困难任务：0.40-0.50

**示例**：
```bash
# 标准配置
--arcface-margin 0.30

# 更强判别性
--arcface-margin 0.40
```

**效果**：
- 增大 margin → 类间距离更大，但可能难以收敛
- 减小 margin → 训练容易，但判别性下降
```

---

## 参考其他项目

我们的文档组织参考了以下优秀项目：

- **PyTorch**：理论文档（Docs）+ API 文档（API Reference）分离
- **TensorFlow**：Tutorials（实践）+ Guide（原理）分离
- **Hugging Face Transformers**：Model Card（原理）+ Usage（接口）分离

---

## 贡献指南

### 添加新内容

1. 确定内容属于"原理"还是"接口"
2. 更新对应的 README.md 或 training_guide.md
3. 保持两个文档的交叉引用一致
4. 添加示例和实际效果

### 文档审查清单

在提交文档更新前，请检查：

- [ ] 原理部分是否有足够的数学推导或伪代码？
- [ ] 接口部分是否有完整的参数说明和示例？
- [ ] 是否包含至少一个可直接运行的命令？
- [ ] 是否说明了常见错误和解决方案？
- [ ] 数学公式是否清晰易懂？
- [ ] 代码示例是否经过测试？
- [ ] 交叉引用是否正确？

---

## 联系与反馈

如有文档问题或建议，请：
- 提交 Issue 到项目仓库
- 发送邮件至维护团队
- 在代码审查中提出

---

**文档版本**：v1.0  
**最后更新**：2024年  
**维护者**：ShuWeiCamp Team